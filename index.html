<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Comando Estrat√©gico de Conte√∫do</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- TUI Image Editor CSS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner, .spinner-sm { border-radius: 50%; animation: spin 1s ease infinite; border: 4px solid rgba(0, 0, 0, 0.1); }
        .spinner { width: 36px; height: 36px; border-left-color: #059669; }
        .spinner-sm { width: 20px; height: 20px; border-left-color: #fff; border-width: 2px;}
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .tab-button { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab-button.active { border-bottom-color: #10b981; color: #059669; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #editor-modal-content, #image-editor-modal-content { max-height: 85vh; }
        .pagination-button { padding: 8px 16px; background-color: #e2e8f0; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
        .pagination-button:hover:not(:disabled) { background-color: #cbd5e1; }
        .pagination-button:disabled { cursor: not-allowed; opacity: 0.5; }
        /* TUI Editor Customization */
        .tui-image-editor-container { min-height: 60vh; }
        .seo-score-good { color: #10b981; }
        .seo-score-ok { color: #f59e0b; }
        .seo-score-bad { color: #ef4444; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Centro de Comando Estrat√©gico de Conte√∫do</h1>
            <p class="text-gray-600 mt-2">A su√≠te definitiva para pesquisar, analisar, criar e monetizar.</p>
        </header>

        <main>
            <!-- Configura√ß√µes de API -->
            <details class="bg-white p-4 rounded-lg shadow-md mb-8">
                <summary class="font-semibold cursor-pointer text-lg">üîë Configura√ß√µes de API (Essencial)</summary>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 border-t pt-4">
                    <div><label for="google-search-key" class="block text-sm font-medium">Google Search Key</label><input type="password" id="google-search-key" class="w-full p-2 border rounded-md"></div>
                    <div><label for="google-cx-id" class="block text-sm font-medium">Google Search CX ID</label><input type="password" id="google-cx-id" class="w-full p-2 border rounded-md"></div>
                    <div><label for="gemini-key" class="block text-sm font-medium">Google AI Key</label><input type="password" id="gemini-key" class="w-full p-2 border rounded-md"></div>
                    <div><label for="extractor-key" class="block text-sm font-medium">ExtractorAPI Key</label><input type="password" id="extractor-key" class="w-full p-2 border rounded-md"></div>
                    <div><label for="youtube-key" class="block text-sm font-medium">YouTube API Key</label><input type="password" id="youtube-key" class="w-full p-2 border rounded-md"></div>
                    <div><label for="unsplash-key" class="block text-sm font-medium">Unsplash Access Key</label><input type="password" id="unsplash-key" class="w-full p-2 border rounded-md"></div>
                </div>
            </details>

            <!-- Abas de Ferramentas -->
            <div class="bg-white rounded-lg shadow-md">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex flex-wrap gap-6 px-6" aria-label="Tabs">
                        <button class="tab-button active" data-tab="market-research">Pesquisa de Mercado</button>
                        <button class="tab-button" data-tab="community-analysis">An√°lise de Comunidades</button>
                        <button class="tab-button" data-tab="affiliate-analysis">Oportunidades de Afilia√ß√£o</button>
                    </nav>
                </div>

                <!-- Conte√∫do da Aba: Pesquisa de Mercado -->
                <div id="market-research" class="tab-content active p-6">
                    <div class="flex flex-col md:flex-row gap-4">
                        <input type="text" id="main-keyword-input" placeholder="Digite um nicho ou palavra-chave..." class="flex-grow p-3 border border-gray-300 rounded-md">
                        <button id="analyze-keyword-button" class="bg-indigo-600 text-white font-semibold py-3 px-4 rounded-md hover:bg-indigo-700 flex-shrink-0">üîç Analisar Palavra-Chave</button>
                    </div>
                    <div class="mt-6 border-t pt-4">
                        <p class="text-center text-gray-600 mb-4 font-semibold">Refinar Busca de Conte√∫do</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><label for="platform-filter" class="block font-bold text-gray-800 mb-2 text-sm">Plataforma</label><select id="platform-filter" class="w-full p-3 border border-gray-300 rounded-md"><option value="">Busca por navega√ß√£o do Google</option><option value="youtube.com">YouTube</option><option value="pinterest.com">Pinterest</option><option value="instagram.com">Instagram</option></select></div>
                            <div><label for="country-filter" class="block font-bold text-gray-800 mb-2 text-sm">Pa√≠s</label><select id="country-filter" class="w-full p-3 border border-gray-300 rounded-md"><option value="">Qualquer</option><option value="countryBR">Brasil</option><option value="countryUS">EUA</option><option value="countryPT">Portugal</option></select></div>
                            <div><label for="date-filter" class="block font-bold text-gray-800 mb-2 text-sm">Data</label><select id="date-filter" class="w-full p-3 border border-gray-300 rounded-md"><option value="">Qualquer</option><option value="d1">√öltimas 24h</option><option value="w1">√öltima semana</option><option value="m1">√öltimo m√™s</option></select></div>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="search-button" class="w-full md:w-1/2 bg-emerald-600 text-white font-semibold py-3 px-6 rounded-md hover:bg-emerald-700">üí° Buscar Conte√∫do</button>
                    </div>
                </div>

                <!-- Conte√∫do da Aba: An√°lise de Comunidades -->
                <div id="community-analysis" class="tab-content p-6">
                     <h2 class="text-2xl font-bold mb-4">Analisador de Comunidades (Reddit)</h2>
                     <div class="flex flex-col md:flex-row gap-4">
                         <input type="text" id="reddit-keyword-input" placeholder="Digite um nicho para encontrar comunidades..." class="flex-grow p-3 border border-gray-300 rounded-md">
                         <button id="reddit-search-button" class="bg-orange-500 text-white font-semibold py-3 px-4 rounded-md hover:bg-orange-600 flex-shrink-0">üó£Ô∏è Buscar no Reddit</button>
                     </div>
                </div>
                
                <!-- Conte√∫do da Aba: Oportunidades de Afilia√ß√£o -->
                <div id="affiliate-analysis" class="tab-content p-6">
                     <h2 class="text-2xl font-bold mb-4">Analisador de Produtos (Amazon)</h2>
                       <div class="flex flex-col md:flex-row gap-4">
                         <input type="text" id="amazon-keyword-input" placeholder="Digite um produto ou nicho..." class="flex-grow p-3 border border-gray-300 rounded-md">
                         <button id="amazon-search-button" class="bg-yellow-500 text-gray-900 font-semibold py-3 px-4 rounded-md hover:bg-yellow-600 flex-shrink-0">üí∞ Buscar na Amazon</button>
                     </div>
                     <p class="text-xs text-gray-500 mt-2">Nota: A API da Amazon √© complexa e requer uma conta de associado aprovada.</p>
                </div>
            </div>

            <!-- Se√ß√£o de Resultados -->
            <div id="loading-spinner" class="hidden justify-center items-center my-10"><div class="spinner"></div></div>
            <div id="results-title" class="text-2xl font-bold text-gray-800 mt-10 mb-2 text-center hidden"></div>
            <div id="results-subtitle" class="text-sm text-gray-600 mb-6 text-center hidden"></div>
            <div id="error-message" class="hidden text-center bg-red-100 text-red-700 p-4 rounded-md my-6"></div>
            <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div id="pagination-container" class="mt-10 flex justify-center items-center gap-4"></div>
        </main>
    </div>

    <!-- Modal do Editor SEO -->
    <div id="editor-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-7xl h-[95vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 class="text-2xl font-bold">Editor e Otimizador SEO</h2>
                <button id="close-editor-button" class="text-2xl font-bold hover:text-red-500">&times;</button>
            </div>
            <div id="editor-modal-content" class="p-6 overflow-y-auto flex-grow">
                <div id="editor-spinner" class="flex justify-center items-center h-64"><div class="spinner"></div></div>
                <div id="editor-content" class="hidden h-full">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-full">
                        <!-- Coluna do Editor -->
                        <div class="lg:col-span-2 flex flex-col">
                            <label class="block font-bold mb-1">T√≠tulo</label>
                            <input id="editor-title" type="text" class="w-full p-2 border rounded-md mb-4">
                            <label class="block font-bold mb-1">Conte√∫do do Artigo</label>
                            <textarea id="editor-text" rows="15" class="w-full p-2 border rounded-md flex-grow"></textarea>
                            <div class="grid grid-cols-3 gap-2 mt-2">
                                <button id="rewrite-button" class="w-full bg-teal-500 text-white font-semibold p-2 rounded-md hover:bg-teal-600 flex items-center justify-center gap-2">‚úçÔ∏è Reescrever</button>
                                <button id="generate-image-button" class="w-full bg-orange-500 text-white font-semibold p-2 rounded-md hover:bg-orange-600 flex items-center justify-center gap-2">üé® Gerar Imagem</button>
                                <button id="promote-button" class="w-full bg-blue-600 text-white font-semibold p-2 rounded-md hover:bg-blue-700 flex items-center justify-center gap-2">üöÄ Promover</button>
                            </div>
                        </div>
                        <!-- Coluna de An√°lise e M√≠dia -->
                        <div class="bg-gray-50 p-4 rounded-lg flex flex-col gap-4 overflow-y-auto">
                            <!-- Otimizador SEO em Tempo Real -->
                            <div>
                                <h3 class="font-bold text-lg mb-2">Otimizador SEO em Tempo Real</h3>
                                <div class="space-y-2">
                                    <label for="focus-keyword" class="block font-bold text-sm">Palavra-Chave Foco:</label>
                                    <input type="text" id="focus-keyword" placeholder="Sua palavra-chave principal" class="w-full p-2 border rounded-md">
                                    <div id="real-time-seo-results" class="text-sm space-y-2 bg-white p-3 rounded-md border"></div>
                                </div>
                            </div>
                             <!-- Banco de M√≠dia -->
                            <div class="border-t pt-4">
                                <h3 class="font-bold text-lg mb-2">Banco de M√≠dia (Unsplash)</h3>
                                <div class="flex gap-2">
                                    <input type="text" id="media-search-input" placeholder="Buscar imagem..." class="w-full p-2 border rounded-md">
                                    <button id="media-search-button" class="bg-gray-700 text-white p-2 rounded-md hover:bg-gray-800">Buscar</button>
                                </div>
                                <div id="media-results-container" class="grid grid-cols-2 gap-2 mt-2 max-h-48 overflow-y-auto"></div>
                            </div>
                             <!-- An√°lise SEO com IA -->
                            <div class="border-t pt-4">
                                <h3 class="font-bold text-lg mb-2">An√°lise SEO com IA</h3>
                                <button id="analyze-seo-button" class="w-full bg-purple-600 text-white font-semibold p-2 rounded-md hover:bg-purple-700 flex items-center justify-center gap-2">Analisar Texto <span id="seo-spinner" class="hidden spinner-sm"></span></button>
                                <div id="seo-results" class="mt-2 text-sm space-y-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal do Gerador de Imagem -->
    <div id="image-generator-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-[60]">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-xl">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-2xl font-bold">Gerador de Imagem com IA</h2>
                <button id="close-image-generator-button" class="text-2xl font-bold hover:text-red-500">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label for="image-prompt" class="block font-bold mb-1">Prompt da Imagem</label>
                    <p class="text-xs text-gray-500 mb-2">Descreva a imagem que voc√™ quer criar. A IA usar√° o t√≠tulo do seu artigo como base.</p>
                    <textarea id="image-prompt" rows="3" class="w-full p-2 border rounded-md"></textarea>
                </div>
                <button id="trigger-image-generation-button" class="w-full bg-orange-500 text-white font-semibold p-3 rounded-md hover:bg-orange-600 flex items-center justify-center gap-2">
                    Gerar Imagem
                    <span id="image-generation-spinner" class="hidden spinner-sm"></span>
                </button>
                <div id="generated-image-container" class="mt-4 text-center bg-gray-100 p-4 rounded-lg min-h-[256px] flex items-center justify-center">
                    <p class="text-gray-500">A sua imagem aparecer√° aqui.</p>
                </div>
                <div id="generated-image-actions" class="hidden text-center mt-2">
                     <button id="insert-generated-image-button" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-green-700">Inserir no Topo do Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal do Editor de Imagem -->
    <div id="image-editor-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-[60]">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-6xl h-[90vh] flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50 rounded-t-lg">
                <h2 class="text-xl font-bold">Editor de Imagem</h2>
                <div>
                    <button id="download-image-button" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-700 mr-2">Download</button>
                    <button id="close-image-editor-button" class="text-2xl font-bold hover:text-red-500">&times;</button>
                </div>
            </div>
            <div id="image-editor-modal-content" class="flex-grow">
                <div id="tui-image-editor-container" class="w-full h-full"></div>
            </div>
        </div>
    </div>

    <!-- Modal do Agendador Social -->
    <div id="social-scheduler-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-[60]">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-3xl">
            <div class="p-6 border-b flex justify-between items-center">
                <h2 class="text-2xl font-bold">Promover Conte√∫do</h2>
                <button id="close-scheduler-button" class="text-2xl font-bold hover:text-red-500">&times;</button>
            </div>
            <div class="p-6 space-y-4">
                 <button id="generate-social-posts-button" class="w-full bg-emerald-600 text-white font-semibold p-3 rounded-md hover:bg-emerald-700 flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M13.873 3.827a.5.5 0 0 0-.42-.235H2.547a.5.5 0 0 0-.42.235L.002 11.24a.5.5 0 0 0 .215.665l1.878.884a.5.5 0 0 0 .642-.23l1.1-2.204a.5.5 0 0 0-.23-.642L2.058 9.38l1.355-2.71a.5.5 0 0 1 .42-.235h7.33a.5.5 0 0 1 .42.235l1.355 2.71-1.147.54a.5.5 0 0 0-.23.642l1.1 2.204a.5.5 0 0 0 .642.23l1.878-.884a.5.5 0 0 0 .215-.665L13.873 3.827zM7.5 16a.5.5 0 0 0 .5.5h.001a.5.5 0 0 0 .5-.5v-1.293l.21-.099a1.5 1.5 0 0 0 .87-1.258l.054-.274a.5.5 0 0 0-.48-.593H5.346a.5.5 0 0 0-.48.593l.054.274a1.5 1.5 0 0 0 .87 1.258l.21.099V16zm-3.19-14.013L4.84 3.01a.5.5 0 0 0 .35.154h5.62a.5.5 0 0 0 .35-.154l.53-1.026a.5.5 0 0 0-.35-.85H4.66a.5.5 0 0 0-.35.85z"/></svg>
                    Gerar Posts com IA
                    <span id="generate-social-spinner" class="hidden spinner-sm"></span>
                </button>
                <div class="space-y-4" id="social-posts-container">
                    <!-- Posts gerados pela IA aparecer√£o aqui -->
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <script src="https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js"></script>
    <script src="https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js"></script>
    <script src="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- ELEMENTOS E ESTADO ---
        const el = {
            googleSearchKey: document.getElementById('google-search-key'), googleCxId: document.getElementById('google-cx-id'), geminiKey: document.getElementById('gemini-key'), extractorKey: document.getElementById('extractor-key'), youtubeKey: document.getElementById('youtube-key'), unsplashKey: document.getElementById('unsplash-key'),
            mainKeywordInput: document.getElementById('main-keyword-input'), analyzeKeywordButton: document.getElementById('analyze-keyword-button'),
            platformFilter: document.getElementById('platform-filter'), countryFilter: document.getElementById('country-filter'), dateFilter: document.getElementById('date-filter'),
            searchButton: document.getElementById('search-button'),
            redditKeywordInput: document.getElementById('reddit-keyword-input'), redditSearchButton: document.getElementById('reddit-search-button'),
            amazonKeywordInput: document.getElementById('amazon-keyword-input'), amazonSearchButton: document.getElementById('amazon-search-button'),
            resultsContainer: document.getElementById('results-container'), loadingSpinner: document.getElementById('loading-spinner'), errorMessage: document.getElementById('error-message'), resultsTitle: document.getElementById('results-title'), resultsSubtitle: document.getElementById('results-subtitle'), paginationContainer: document.getElementById('pagination-container'),
            aiModal: document.getElementById('ai-modal'), aiModalTitle: document.getElementById('ai-modal-title'), aiModalContent: document.getElementById('ai-modal-content'), aiModalSpinner: document.getElementById('ai-modal-spinner'), closeAiModalButton: document.getElementById('close-ai-modal-button'),
            editorModal: document.getElementById('editor-modal'), closeEditorButton: document.getElementById('close-editor-button'), editorSpinner: document.getElementById('editor-spinner'), editorContent: document.getElementById('editor-content'),
            editorTitle: document.getElementById('editor-title'), editorText: document.getElementById('editor-text'), rewriteButton: document.getElementById('rewrite-button'), rewriteSpinner: document.getElementById('rewrite-spinner'),
            analyzeSeoButton: document.getElementById('analyze-seo-button'), seoSpinner: document.getElementById('seo-spinner'), seoResults: document.getElementById('seo-results'),
            imageEditorModal: document.getElementById('image-editor-modal'), closeImageEditorButton: document.getElementById('close-image-editor-button'), downloadImageButton: document.getElementById('download-image-button'),
            promoteButton: document.getElementById('promote-button'),
            socialSchedulerModal: document.getElementById('social-scheduler-modal'),
            closeSchedulerButton: document.getElementById('close-scheduler-button'),
            generateSocialPostsButton: document.getElementById('generate-social-posts-button'),
            generateSocialSpinner: document.getElementById('generate-social-spinner'),
            socialPostsContainer: document.getElementById('social-posts-container'),
            focusKeyword: document.getElementById('focus-keyword'),
            realTimeSeoResults: document.getElementById('real-time-seo-results'),
            mediaSearchInput: document.getElementById('media-search-input'),
            mediaSearchButton: document.getElementById('media-search-button'),
            mediaResultsContainer: document.getElementById('media-results-container'),
            generateImageButton: document.getElementById('generate-image-button'),
            imageGeneratorModal: document.getElementById('image-generator-modal'),
            closeImageGeneratorButton: document.getElementById('close-image-generator-button'),
            imagePrompt: document.getElementById('image-prompt'),
            triggerImageGenerationButton: document.getElementById('trigger-image-generation-button'),
            imageGenerationSpinner: document.getElementById('image-generation-spinner'),
            generatedImageContainer: document.getElementById('generated-image-container'),
            insertGeneratedImageButton: document.getElementById('insert-generated-image-button'),
            generatedImageActions: document.getElementById('generated-image-actions'),
        };

        let state = { currentQuery: '', totalResults: 0, currentPage: 1, imageEditorInstance: null };

        // --- L√ìGICA DE ABAS ---
        const changeTab = (tabName, clickedButton) => {
            document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(tb => tb.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            clickedButton.classList.add('active');
            el.resultsContainer.innerHTML = '';
            el.resultsTitle.style.display = 'none';
            el.resultsSubtitle.style.display = 'none';
            el.paginationContainer.innerHTML = '';
        }

        // --- L√ìGICA DE BUSCA PRINCIPAL ---
        const startNewSearch = () => {
            const keyword = el.mainKeywordInput.value.trim();
            if (!keyword) { displayError("Por favor, digite um nicho ou palavra-chave para buscar."); return; }
            const platform = el.platformFilter.value;
            const platformQuery = platform ? `site:${platform}` : '';
            state.currentQuery = `${platformQuery} "${keyword}"`.trim();
            state.currentPage = 1;
            fetchAndDisplayPage(state.currentPage);
        }

        const fetchAndDisplayPage = async (page) => {
            const apiKey = el.googleSearchKey.value.trim();
            const cxId = el.googleCxId.value.trim();
            if (!apiKey || !cxId) { displayError("Configure sua API Key e CX ID do Google Search."); return; }

            setLoadingState(true);
            const startIndex = (page - 1) * 10 + 1;
            let apiUrl = `https://www.googleapis.com/customsearch/v1?key=${apiKey}&cx=${cxId}&q=${encodeURIComponent(state.currentQuery)}&num=10&start=${startIndex}`;
            const dateRestrict = el.dateFilter.value;
            const countryRestrict = el.countryFilter.value;
            if (dateRestrict) apiUrl += `&dateRestrict=${dateRestrict}`;
            if (countryRestrict) apiUrl += `&cr=${countryRestrict}`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                if (page === 1) state.totalResults = data.searchInformation ? parseInt(data.searchInformation.totalResults) : 0;
                el.resultsTitle.textContent = `Resultados para: "${state.currentQuery.trim()}"`;
                el.resultsTitle.style.display = 'block';
                state.currentPage = page;
                displayGoogleResults(data.items || []);
                setupPagination();
            } catch (error) {
                displayError(`Erro ao buscar: ${error.message}`);
            } finally {
                setLoadingState(false);
            }
        }

        const displayGoogleResults = (items) => {
            el.resultsContainer.innerHTML = '';
            if (items.length === 0) { displayError("Nenhum resultado encontrado."); el.resultsTitle.style.display = 'none'; return; }
            el.resultsSubtitle.textContent = `Aproximadamente ${state.totalResults.toLocaleString()} resultados encontrados.`;
            el.resultsSubtitle.style.display = 'block';

            items.forEach(item => {
                let imageUrl = item.pagemap?.cse_image?.[0]?.src || 'https://placehold.co/600x400/e2e8f0/4a5568?text=Sem+Imagem';
                const card = document.createElement('div');
                card.className = "bg-white rounded-lg shadow-md overflow-hidden flex flex-col";
                
                let buttonsHtml = `<a href="${item.link}" target="_blank" rel="noopener noreferrer" class="text-center bg-gray-800 text-white font-semibold py-2 px-3 rounded-md hover:bg-gray-900">Visitar</a>`;
                if(item.link.includes("youtube.com/watch?v=")) {
                    const videoId = new URL(item.link).searchParams.get('v');
                    buttonsHtml += `<button data-video-id="${videoId}" class="analyze-video-button text-center bg-red-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-red-700">üé• Analisar</button>`;
                } else {
                    buttonsHtml += `<button data-url="${item.link}" class="extract-button text-center bg-teal-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-teal-700">üìñ Extrair</button>`;
                }
                buttonsHtml += `<button onclick="window.open('https://ahrefs.com/backlink-checker?url=${encodeURIComponent(item.link)}', '_blank')" class="text-center bg-indigo-600 text-white font-semibold py-2 px-3 rounded-md hover:bg-indigo-700">üîó Backlinks</button>`;

                card.innerHTML = `<img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/4a5568?text=Erro';" class="w-full h-48 object-cover"><div class="p-4 flex flex-col flex-grow"><h3 class="text-lg font-bold mb-2">${item.title}</h3><p class="text-sm text-gray-700 mb-4 flex-grow">${item.snippet || 'Descri√ß√£o n√£o dispon√≠vel.'}</p><div class="mt-auto grid grid-cols-3 gap-2 text-sm">${buttonsHtml}</div></div>`;
                
                const extractButton = card.querySelector('.extract-button');
                if (extractButton) extractButton.addEventListener('click', (e) => openSeoEditor(e.currentTarget.dataset.url));
                
                const analyzeVideoButton = card.querySelector('.analyze-video-button');
                if(analyzeVideoButton) analyzeVideoButton.addEventListener('click', (e) => { /* Implement analyzeYouTubeVideo */ });

                el.resultsContainer.appendChild(card);
            });
        }
        
        // --- L√ìGICA DO EDITOR SEO ---
        const openSeoEditor = async (url) => {
            el.editorModal.style.display = 'flex';
            el.editorContent.style.display = 'none';
            el.editorSpinner.style.display = 'flex';
            el.seoResults.innerHTML = '';
            el.editorTitle.value = '';
            el.editorText.value = '';

            const extractorKey = el.extractorKey.value.trim();
            if (!extractorKey) { 
                displayErrorInModal("Configure sua API Key do ExtractorAPI."); 
                return; 
            }
            try {
                const apiUrl = `https://extractorapi.com/api/v1/extractor/?apikey=${extractorKey}&url=${encodeURIComponent(url)}`;
                const response = await fetch(apiUrl);
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                
                el.editorTitle.value = data.title || '';
                el.editorText.value = data.text || '';

                el.editorSpinner.style.display = 'none';
                el.editorContent.style.display = 'block';

                updateRealTimeSeo();
                analyzeSEO();

            } catch (error) { 
                displayErrorInModal(`Erro ao extrair: ${error.message}`); 
            }
        }
        
        const closeEditor = () => { el.editorModal.style.display = 'none'; }

        const rewriteWithAI = async () => {
            const originalText = el.editorText.value;
            if (!originalText.trim()) { alert("N√£o h√° texto para reescrever."); return; }
            el.rewriteSpinner.style.display = 'inline-block';
            el.rewriteButton.disabled = true;
            try {
                const prompt = `Reescreva o seguinte texto de forma mais clara, envolvente e otimizada para SEO, mantendo a ideia central. Texto original: "${originalText}"`;
                const rewrittenText = await callGeminiAPI(prompt);
                el.editorText.value = rewrittenText;
                updateRealTimeSeo();
            } catch (error) {
                alert(`Erro ao reescrever: ${error.message}`);
            } finally {
                el.rewriteSpinner.style.display = 'none';
                el.rewriteButton.disabled = false;
            }
        }

        const analyzeSEO = async (event) => {
            const title = el.editorTitle.value;
            const text = el.editorText.value;
            if (!text.trim() || !title.trim()) {
                if (event) alert("√â necess√°rio ter um t√≠tulo e um texto para analisar o SEO.");
                return;
            }
            el.seoSpinner.style.display = 'inline-block';
            el.analyzeSeoButton.disabled = true;
            el.seoResults.innerHTML = '<div class="flex justify-center"><div class="spinner-sm border-left-color-purple-600"></div></div>';
            try {
                const prompt = `Analise o seguinte conte√∫do para SEO. Forne√ßa um feedback detalhado e pr√°tico em portugu√™s. T√≠tulo: "${title}". Conte√∫do: "${text}". A an√°lise deve incluir: 1. **An√°lise de Palavra-chave:** Identifique a palavra-chave principal e sugira 3 secund√°rias. 2. **Otimiza√ß√£o do T√≠tulo:** Avalie o t√≠tulo e sugira 2 alternativas melhores. 3. **Meta Descri√ß√£o:** Crie uma meta descri√ß√£o otimizada com at√© 155 caracteres. 4. **Sugest√£o de Slug:** Crie um slug otimizado para URL (letras min√∫sculas, sem espa√ßos ou caracteres especiais, hifens para separar palavras) com base no t√≠tulo. 5. **Estrutura de Cabe√ßalhos:** Avalie o uso de H1, H2, etc. e sugira melhorias. 6. **Legibilidade:** Comente sobre a clareza e a estrutura do texto. Formate a resposta de forma clara com t√≠tulos para cada se√ß√£o.`;
                const seoAnalysis = await callGeminiAPI(prompt);
                el.seoResults.innerHTML = seoAnalysis.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<strong class="text-purple-800">$1</strong>');
            } catch (error) {
                el.seoResults.innerHTML = `<p class="text-red-500">Erro ao analisar SEO: ${error.message}</p>`;
            } finally {
                el.seoSpinner.style.display = 'none';
                el.analyzeSeoButton.disabled = false;
            }
        }

        // --- OTIMIZADOR SEO EM TEMPO REAL ---
        const updateRealTimeSeo = () => {
            const text = el.editorText.value;
            const keyword = el.focusKeyword.value.trim().toLowerCase();
            const words = text.trim().split(/\s+/).filter(Boolean);
            const wordCount = words.length;

            let resultsHtml = `<p><strong>Contagem de Palavras:</strong> ${wordCount}</p>`;

            if (keyword) {
                const keywordCount = (text.toLowerCase().match(new RegExp(`\\b${keyword}\\b`, 'g')) || []).length;
                const density = wordCount > 0 ? ((keywordCount / wordCount) * 100).toFixed(2) : 0;
                
                let densityClass = 'seo-score-bad';
                if (density >= 1 && density <= 2.5) {
                    densityClass = 'seo-score-good';
                } else if (density >= 0.5 && density < 1) {
                    densityClass = 'seo-score-ok';
                }
                resultsHtml += `<p><strong>Densidade da Palavra-Chave:</strong> <span class="${densityClass}">${density}%</span> (Ocorr√™ncias: ${keywordCount})</p>`;
                resultsHtml += `<p class="text-xs text-gray-500">Ideal: entre 1% e 2.5%</p>`;
            } else {
                 resultsHtml += `<p class="text-xs text-gray-500">Insira uma palavra-chave foco para mais an√°lises.</p>`;
            }
            
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
            const sentenceCount = sentences.length;
            const syllableCount = (text.match(/[aeiouy]{1,2}/gi) || []).length; 
            if(sentenceCount > 0 && wordCount > 0) {
                const fleschScore = 206.835 - 1.015 * (wordCount / sentenceCount) - 84.6 * (syllableCount / wordCount);
                let readabilityText = "Muito Dif√≠cil";
                let readabilityClass = "seo-score-bad";
                if(fleschScore >= 60) { readabilityText = "F√°cil de ler"; readabilityClass = "seo-score-good"; }
                else if (fleschScore >= 30) { readabilityText = "Leitura OK"; readabilityClass = "seo-score-ok"; }
                resultsHtml += `<p><strong>Legibilidade:</strong> <span class="${readabilityClass}">${readabilityText}</span></p>`;
            }

            el.realTimeSeoResults.innerHTML = resultsHtml;
        }

        // --- BANCO DE M√çDIA (UNSPLASH) ---
        const searchUnsplash = async () => {
            const query = el.mediaSearchInput.value.trim();
            const unsplashKey = el.unsplashKey.value.trim();
            if(!query) { alert("Digite um termo para buscar."); return; }
            if(!unsplashKey) { alert("Configure sua Unsplash Access Key nas configura√ß√µes."); return; }

            el.mediaResultsContainer.innerHTML = '<div class="col-span-2 flex justify-center"><div class="spinner-sm"></div></div>';
            
            try {
                const response = await fetch(`https://api.unsplash.com/search/photos?query=${query}&per_page=10&client_id=${unsplashKey}`);
                const data = await response.json();
                if(!response.ok) throw new Error(data.errors[0]);

                el.mediaResultsContainer.innerHTML = '';
                if(data.results.length === 0) {
                     el.mediaResultsContainer.innerHTML = '<p class="col-span-2 text-center text-sm">Nenhum resultado.</p>';
                }
                data.results.forEach(img => {
                    const imgCard = document.createElement('div');
                    imgCard.className = 'relative group cursor-pointer';
                    imgCard.innerHTML = `<img src="${img.urls.thumb}" alt="${img.alt_description}" class="w-full h-full object-cover rounded-md">
                                        <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                            <p class="text-white text-xs text-center p-1">Inserir Imagem</p>
                                        </div>`;
                    imgCard.addEventListener('click', () => insertImageFromUnsplash(img));
                    el.mediaResultsContainer.appendChild(imgCard);
                });
            } catch (error) {
                el.mediaResultsContainer.innerHTML = `<p class="col-span-2 text-red-500 text-sm">Erro: ${error.message}</p>`;
            }
        }

        const insertImageFromUnsplash = (img) => {
            const markdown = `\n![${img.alt_description || 'Imagem do Unsplash'}](${img.urls.regular})\n`;
            el.editorText.value += markdown;
            el.editorText.scrollTop = el.editorText.scrollHeight;
        }

        // --- L√ìGICA DO EDITOR DE IMAGEM ---
        const openImageEditor = (imageUrl) => {
            el.imageEditorModal.style.display = 'flex';
            if (state.imageEditorInstance) state.imageEditorInstance.destroy();
            
            state.imageEditorInstance = new tui.ImageEditor('#tui-image-editor-container', {
                includeUI: {
                    loadImage: { path: imageUrl, name: 'Imagem' },
                    theme: {},
                    menu: ['crop', 'flip', 'rotate', 'draw', 'shape', 'text', 'filter'],
                    initMenu: 'filter',
                    uiSize: { width: '100%', height: '100%' },
                    menuBarPosition: 'bottom',
                },
                cssMaxWidth: 700, cssMaxHeight: 500, usageStatistics: false,
            });
            const editorEl = document.querySelector('.tui-image-editor-canvas-container');
            if (editorEl) editorEl.style.height = '100%';
        }
        
        const closeImageEditor = () => {
            if (state.imageEditorInstance) { state.imageEditorInstance.destroy(); state.imageEditorInstance = null; }
            el.imageEditorModal.style.display = 'none';
        }

        const downloadEditedImage = () => {
            if (state.imageEditorInstance) {
                const link = document.createElement('a');
                link.download = 'edited-image.png';
                link.href = state.imageEditorInstance.toDataURL();
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        // --- GERADOR DE IMAGEM ---
        const openImageGenerator = () => {
            el.imageGeneratorModal.style.display = 'flex';
            el.imagePrompt.value = el.editorTitle.value;
            el.generatedImageContainer.innerHTML = '<p class="text-gray-500">A sua imagem aparecer√° aqui.</p>';
            el.generatedImageActions.style.display = 'none';
        }

        const closeImageGenerator = () => {
            el.imageGeneratorModal.style.display = 'none';
        }

        const generateImageWithAI = async () => {
            const prompt = el.imagePrompt.value.trim();
            if (!prompt) {
                alert("Por favor, insira um prompt para a imagem.");
                return;
            }
            const apiKey = el.geminiKey.value.trim();
            if (!apiKey) {
                alert("Por favor, configure sua Google AI Key.");
                return;
            }

            el.imageGenerationSpinner.style.display = 'inline-block';
            el.triggerImageGenerationButton.disabled = true;
            el.generatedImageContainer.innerHTML = '<div class="spinner"></div>';
            el.generatedImageActions.style.display = 'none';
            
            try {
                const payload = { instances: [{ prompt: prompt }], parameters: { "sampleCount": 1 } };
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                    const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                    el.generatedImageContainer.innerHTML = `<img src="${imageUrl}" alt="Imagem Gerada por IA" class="max-w-full max-h-96 rounded-md">`;
                    el.generatedImageActions.style.display = 'block';
                } else {
                    throw new Error("A resposta da API n√£o continha uma imagem v√°lida.");
                }
            } catch (error) {
                el.generatedImageContainer.innerHTML = `<p class="text-red-500">Erro ao gerar imagem: ${error.message}</p>`;
            } finally {
                el.imageGenerationSpinner.style.display = 'none';
                el.triggerImageGenerationButton.disabled = false;
            }
        }

        const insertGeneratedImage = () => {
            const imgElement = el.generatedImageContainer.querySelector('img');
            if (imgElement) {
                const imageUrl = imgElement.src;
                const markdown = `![${el.imagePrompt.value}](${imageUrl})\n\n`;
                el.editorText.value = markdown + el.editorText.value;
                closeImageGenerator();
            }
        }

        // --- AGENDADOR SOCIAL ---
        const openScheduler = () => {
            el.socialSchedulerModal.style.display = 'flex';
            el.socialPostsContainer.innerHTML = '';
        }

        const closeScheduler = () => {
            el.socialSchedulerModal.style.display = 'none';
        }

        const generateSocialPosts = async () => {
            const title = el.editorTitle.value;
            const text = el.editorText.value;
            if (!text.trim() || !title.trim()) {
                alert("√â necess√°rio ter um t√≠tulo e um texto para gerar os posts.");
                return;
            }
            el.generateSocialSpinner.style.display = 'inline-block';
            el.generateSocialPostsButton.disabled = true;
            el.socialPostsContainer.innerHTML = '';

            try {
                const prompt = `Com base no seguinte artigo, crie 3 posts curtos para redes sociais para promov√™-lo. T√≠tulo: "${title}". Conte√∫do: "${text.substring(0, 2000)}". Gere um post para o X (Twitter) (m√°x 280 caracteres), um para o Facebook (mais descritivo) e um para o LinkedIn (mais profissional). Formate a resposta como um objeto JSON com as chaves "twitter", "facebook" e "linkedin".`;
                const responseText = await callGeminiAPI(prompt);
                const posts = JSON.parse(responseText.replace(/```json|```/g, ''));
                
                displaySocialPost('X (Twitter)', posts.twitter);
                displaySocialPost('Facebook', posts.facebook);
                displaySocialPost('LinkedIn', posts.linkedin);

            } catch (error) {
                el.socialPostsContainer.innerHTML = `<p class="text-red-500">Erro ao gerar posts: ${error.message}</p>`;
            } finally {
                el.generateSocialSpinner.style.display = 'none';
                el.generateSocialPostsButton.disabled = false;
            }
        }

        const displaySocialPost = (platform, text) => {
            const postDiv = document.createElement('div');
            postDiv.className = 'bg-gray-100 p-4 rounded-lg';
            postDiv.innerHTML = `
                <h4 class="font-bold text-lg">${platform}</h4>
                <textarea rows="4" class="w-full p-2 border rounded-md mt-2">${text}</textarea>
                <div class="text-right mt-2">
                    <button class="bg-gray-600 text-white font-semibold py-1 px-3 rounded-md hover:bg-gray-700 text-sm">Agendar (Simula√ß√£o)</button>
                </div>
            `;
            el.socialPostsContainer.appendChild(postDiv);
        }
        
        // --- FUN√á√ïES DE UI E GERAIS ---
        const setupPagination = () => {
            el.paginationContainer.innerHTML = '';
            const totalPages = Math.min(Math.ceil(state.totalResults / 10), 10);
            if (totalPages <= 1) return;
            
            const prevButton = document.createElement('button'); 
            prevButton.innerHTML = '&laquo; Anterior'; 
            prevButton.className = 'pagination-button'; 
            prevButton.disabled = state.currentPage === 1; 
            prevButton.addEventListener('click', () => fetchAndDisplayPage(state.currentPage - 1)); 
            el.paginationContainer.appendChild(prevButton);
            
            const pageIndicator = document.createElement('span'); 
            pageIndicator.textContent = `P√°gina ${state.currentPage} de ${totalPages}`; 
            pageIndicator.className = 'font-semibold text-gray-700 px-4'; 
            el.paginationContainer.appendChild(pageIndicator);
            
            const nextButton = document.createElement('button'); 
            nextButton.innerHTML = 'Pr√≥ximo &raquo;'; 
            nextButton.className = 'pagination-button'; 
            nextButton.disabled = state.currentPage >= totalPages; 
            nextButton.addEventListener('click', () => fetchAndDisplayPage(state.currentPage + 1)); 
            el.paginationContainer.appendChild(nextButton);
        }

        const setLoadingState = (isLoading) => {
            el.loadingSpinner.style.display = isLoading ? 'flex' : 'none';
            if(isLoading) { 
                el.errorMessage.style.display = 'none'; 
                el.resultsContainer.innerHTML = ''; 
                el.paginationContainer.innerHTML = ''; 
                el.resultsTitle.style.display = 'none';
                el.resultsSubtitle.style.display = 'none';
            }
        }
        const displayError = (message) => { 
            setLoadingState(false); 
            el.errorMessage.textContent = message; 
            el.errorMessage.style.display = 'block'; 
            el.resultsTitle.style.display = 'none'; 
            el.resultsSubtitle.style.display = 'none'; 
        }
        const displayErrorInModal = (message) => { 
            el.editorSpinner.style.display = 'none'; 
            el.editorContent.innerHTML = `<p class="text-red-500 text-center p-8">${message}</p>`; 
            el.editorContent.style.display = 'block'; 
        }
        
        const callGeminiAPI = async (prompt) => {
            const geminiKey = el.geminiKey.value.trim();
            if (!geminiKey) { throw new Error("API Key do Google AI n√£o configurada."); }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${geminiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || `HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Sem resposta da IA.";
            } catch (error) {
                console.error("Erro na chamada da API Gemini:", error);
                throw error;
            }
        }

        // --- EVENT LISTENERS ---
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', (event) => {
                const tabName = event.currentTarget.dataset.tab;
                changeTab(tabName, event.currentTarget);
            });
        });

        el.searchButton.addEventListener('click', startNewSearch);
        el.analyzeKeywordButton.addEventListener('click', () => {
             const keyword = el.mainKeywordInput.value.trim();
            if (!keyword) { alert("Por favor, digite uma palavra-chave para analisar."); return; }
            window.open(`https://trends.google.com/trends/explore?q=${encodeURIComponent(keyword)}`, '_blank');
            window.open(`https://app.neilpatel.com/en/ubersuggest/keyword_overview?keyword=${encodeURIComponent(keyword)}`, '_blank');
            window.open(`https://answerthepublic.com/search?query=${encodeURIComponent(keyword)}`, '_blank');
        });
        el.redditSearchButton.addEventListener('click', () => { /* Implement Reddit Search */ });
        el.amazonSearchButton.addEventListener('click', () => displayError("Funcionalidade da Amazon requer configura√ß√£o de backend."));
        el.closeEditorButton.addEventListener('click', closeEditor);
        el.rewriteButton.addEventListener('click', rewriteWithAI);
        el.analyzeSeoButton.addEventListener('click', analyzeSEO);
        el.closeImageEditorButton.addEventListener('click', closeImageEditor);
        el.downloadImageButton.addEventListener('click', downloadEditedImage);
        el.promoteButton.addEventListener('click', openScheduler);
        el.closeSchedulerButton.addEventListener('click', closeScheduler);
        el.generateSocialPostsButton.addEventListener('click', generateSocialPosts);
        el.editorText.addEventListener('keyup', updateRealTimeSeo);
        el.focusKeyword.addEventListener('keyup', updateRealTimeSeo);
        el.mediaSearchButton.addEventListener('click', searchUnsplash);
        el.mediaSearchInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') searchUnsplash(); });
        el.generateImageButton.addEventListener('click', openImageGenerator);
        el.closeImageGeneratorButton.addEventListener('click', closeImageGenerator);
        el.triggerImageGenerationButton.addEventListener('click', generateImageWithAI);
        el.insertGeneratedImageButton.addEventListener('click', insertGeneratedImage);

    });
    </script>
</body>
</html>
